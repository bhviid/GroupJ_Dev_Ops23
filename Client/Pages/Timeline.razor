@page "/public"
@inject HttpClient http

<h2>public timeline</h2>
<TwitDisplayer TwitData="TwitData" Gravatars="gravatars" />

@code 
{
    public List<MsgDataPair> TwitData { get; set; } = new List<MsgDataPair>();
    private Dictionary<string, string> gravatars = new Dictionary<string, string>();
    private int gravatarSize = 48;

    protected override async Task OnInitializedAsync()
    {
        //public tweets - not logged in or user logged in on "/public"
        var res = await http.GetFromJsonAsync<MsgDataPair[]>("/minitwit");   
       
        foreach(var m in res!)
        {
            var authormail = m.Author.email;
            gravatars[authormail] = await http.GetStringAsync($"/minitwit/md5/{authormail}/{gravatarSize}");
        }
        TwitData = res!.ToList();
    }
}